#!/bin/bash

# Перевірка наявності аргументів командного рядка
if [ $# -lt 2 ]; then
    echo "Usage: $0 <namespace> <kubectl_command>"
    exit 1
fi

# Оголошення змінних
NAMESPACE=$1
KUBECTL_COMMAND=$2

# Отримання статистики використання ресурсів з Kubernetes та вивід її у форматі "Resource, Namespace, Name, CPU, Memory"
kubectl $KUBECTL_COMMAND get pods -n $NAMESPACE --no-headers | while read -r line; do
    # Витягнення імені, CPU та пам'яті з результатів
    NAME=$(echo "$line" | awk '{print $1}')
    CPU=$(echo "$line" | awk '{print $2}')
    MEMORY=$(echo "$line" | awk '{print $3}')

    # Вивід статистики у відповідний формат
    echo "Resource, Namespace, Name, CPU, Memory"
    echo "Pod, $NAMESPACE, $NAME, $CPU, $MEMORY"
done
